<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hall Effect Physics Simulator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .controls {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }
        
        .simulation {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 600px;
        }
        
        .results {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            margin-top: 20px;
        }
        
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #eef2f7;
            display: block;
            margin: 0 auto;
        }
        
        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        
        input[type="range"], select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        select {
            height: 36px;
        }
        
        .value-display {
            font-weight: normal;
            color: #7f8c8d;
            margin-left: 8px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .result-item {
            margin-bottom: 8px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
        
        .result-value {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .parameter-section, .result-section {
            margin-bottom: 20px;
        }
        
        .parameter-section h3, .result-section h3 {
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }
        
        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            margin-left: 5px;
            cursor: help;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 10px;
            margin-right: 5px;
        }
        
        .chart-container {
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 10px;
        }
        
        .tab {
            padding: 10px 15px;
            background-color: #ddd;
            border: none;
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: background-color 0.3s;
        }
        
        .tab.active {
            background-color: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab:first-child {
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
        }
        
        .tab:last-child {
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Hall Effect Physics Simulator</h1>
    <p style="text-align: center;">Explore how the Hall Effect works in different materials by adjusting parameters below</p>
    
    <div class="container">
        <div class="controls">
            <div class="parameter-section">
                <h3>Material Parameters</h3>
                
                <label>
                    Material Type
                    <div class="tooltip"><span class="info-icon">i</span>
                        <span class="tooltiptext">Different materials have different carrier types and concentrations.</span>
                    </div>
                </label>
                <select id="material-type">
                    <option value="copper">Copper (Metal)</option>
                    <option value="aluminum">Aluminum (Metal)</option>
                    <option value="germanium-n">n-type Germanium (Semiconductor)</option>
                    <option value="germanium-p">p-type Germanium (Semiconductor)</option>
                    <option value="silicon-n">n-type Silicon (Semiconductor)</option>
                    <option value="silicon-p">p-type Silicon (Semiconductor)</option>
                    <option value="gallium-arsenide">Gallium Arsenide (Semiconductor)</option>
                    <option value="custom">Custom Material</option>
                </select>
                
                <div id="custom-parameters" style="display: none;">
                    <label>
                        Carrier Type
                        <div class="tooltip"><span class="info-icon">i</span>
                            <span class="tooltiptext">Electrons are negative carriers, holes are positive carriers.</span>
                        </div>
                    </label>
                    <select id="carrier-type">
                        <option value="electrons">Electrons (negative)</option>
                        <option value="holes">Holes (positive)</option>
                    </select>
                    
                    <label>
                        Carrier Concentration (m<sup>-3</sup>)
                        <div class="tooltip"><span class="info-icon">i</span>
                            <span class="tooltiptext">Typical values range from 10^16 to 10^28 m^-3.</span>
                        </div>
                        <span class="value-display" id="concentration-value">1.00 × 10^28</span>
                    </label>
                    <input type="range" id="carrier-concentration" min="16" max="28" step="0.1" value="28">
                    
                    <label>
                        Carrier Mobility (m<sup>2</sup>/Vs)
                        <div class="tooltip"><span class="info-icon">i</span>
                            <span class="tooltiptext">How easily carriers move through the material.</span>
                        </div>
                        <span class="value-display" id="mobility-value">0.0032</span>
                    </label>
                    <input type="range" id="carrier-mobility" min="-4" max="-1" step="0.1" value="-2.5">
                </div>
            </div>
            
            <div class="parameter-section">
                <h3>Experimental Setup</h3>
                
                <label>
                    Sample Width (mm)
                    <div class="tooltip"><span class="info-icon">i</span>
                        <span class="tooltiptext">Width of the sample perpendicular to current.</span>
                    </div>
                    <span class="value-display" id="width-value">10.0</span>
                </label>
                <input type="range" id="sample-width" min="1" max="20" step="0.1" value="10">
                
                <label>
                    Sample Thickness (mm)
                    <div class="tooltip"><span class="info-icon">i</span>
                        <span class="tooltiptext">Thickness of the sample in the direction of magnetic field.</span>
                    </div>
                    <span class="value-display" id="thickness-value">1.0</span>
                </label>
                <input type="range" id="sample-thickness" min="0.1" max="5" step="0.1" value="1">
                
                <label>
                    Current (mA)
                    <div class="tooltip"><span class="info-icon">i</span>
                        <span class="tooltiptext">Current flowing through the sample.</span>
                    </div>
                    <span class="value-display" id="current-value">100</span>
                </label>
                <input type="range" id="current" min="10" max="500" step="10" value="100">
                
                <label>
                    Magnetic Field Strength (T)
                    <div class="tooltip"><span class="info-icon">i</span>
                        <span class="tooltiptext">Strength of the applied magnetic field.</span>
                    </div>
                    <span class="value-display" id="field-value">1.0</span>
                </label>
                <input type="range" id="magnetic-field" min="0" max="2" step="0.1" value="1">
            </div>
            
            <button id="run-simulation">Run Simulation</button>
            <button id="reset-simulation">Reset Defaults</button>
        </div>
        
        <div class="simulation">
            <div class="tabs">
                <button class="tab active" data-tab="simulation-view">Simulation</button>
                <button class="tab" data-tab="graph-view">Graphs</button>
            </div>
            
            <div id="simulation-view" class="tab-content active">
                <canvas id="simulation-canvas" width="550" height="400"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: blue;"></div>
                        <span>Electrons</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: red;"></div>
                        <span>Holes</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: green;"></div>
                        <span>Electric Field</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: purple;"></div>
                        <span>Magnetic Field</span>
                    </div>
                </div>
            </div>
            
            <div id="graph-view" class="tab-content">
                <div class="chart-container">
                    <canvas id="hall-voltage-chart" width="550" height="180"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="hall-coefficient-chart" width="550" height="180"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="results">
        <div class="result-section">
            <h3>Results</h3>
            <div class="result-item">
                <span>Hall Voltage (V<sub>H</sub>)</span>
                <span class="result-value" id="hall-voltage">0.00 μV</span>
            </div>
            <div class="result-item">
                <span>Hall Coefficient (R<sub>H</sub>)</span>
                <span class="result-value" id="hall-coefficient">0.00 m³/C</span>
            </div>
            <div class="result-item">
                <span>Carrier Concentration</span>
                <span class="result-value" id="carrier-concentration-result">0.00 m⁻³</span>
            </div>
            <div class="result-item">
                <span>Carrier Type</span>
                <span class="result-value" id="carrier-type-result">Electrons (negative)</span>
            </div>
        </div>
        
        <div class="result-section">
            <h3>Theory</h3>
            <p>The Hall Effect is the production of a voltage difference (the Hall voltage) across an electrical conductor, transverse to an electric current in the conductor and to an applied magnetic field perpendicular to the current.</p>
            <p>Key Equations:</p>
            <ul>
                <li>Hall Voltage: V<sub>H</sub> = (I × B) / (n × e × t)</li>
                <li>Hall Coefficient: R<sub>H</sub> = E<sub>y</sub> / (j<sub>x</sub> × B<sub>z</sub>) = 1 / (n × e)</li>
                <li>Carrier Concentration: n = 1 / (|R<sub>H</sub>| × e)</li>
            </ul>
            <p>Where:</p>
            <ul>
                <li>I = Current through the sample</li>
                <li>B = Magnetic field strength</li>
                <li>n = Carrier concentration</li>
                <li>e = Elementary charge (1.602 × 10<sup>-19</sup> C)</li>
                <li>t = Sample thickness</li>
                <li>E<sub>y</sub> = Electric field in y-direction</li>
                <li>j<sub>x</sub> = Current density in x-direction</li>
                <li>B<sub>z</sub> = Magnetic field in z-direction</li>
            </ul>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Constants
        const ELEMENTARY_CHARGE = 1.602e-19; // C
        
        // Material properties database
        const MATERIALS = {
            "copper": {
                name: "Copper (Metal)",
                carrierType: "electrons",
                concentration: 8.5e28, // m^-3
                mobility: 0.0032 // m^2/Vs
            },
            "aluminum": {
                name: "Aluminum (Metal)",
                carrierType: "electrons",
                concentration: 6.0e28, // m^-3
                mobility: 0.0012 // m^2/Vs
            },
            "germanium-n": {
                name: "n-type Germanium (Semiconductor)",
                carrierType: "electrons",
                concentration: 2.5e19, // m^-3
                mobility: 0.39 // m^2/Vs
            },
            "germanium-p": {
                name: "p-type Germanium (Semiconductor)",
                carrierType: "holes",
                concentration: 2.5e19, // m^-3
                mobility: 0.19 // m^2/Vs
            },
            "silicon-n": {
                name: "n-type Silicon (Semiconductor)",
                carrierType: "electrons",
                concentration: 1.5e22, // m^-3
                mobility: 0.14 // m^2/Vs
            },
            "silicon-p": {
                name: "p-type Silicon (Semiconductor)",
                carrierType: "holes",
                concentration: 1.5e22, // m^-3
                mobility: 0.048 // m^2/Vs
            },
            "gallium-arsenide": {
                name: "Gallium Arsenide (Semiconductor)",
                carrierType: "electrons",
                concentration: 2.0e18, // m^-3
                mobility: 0.85 // m^2/Vs
            },
            "custom": {
                name: "Custom Material",
                carrierType: "electrons",
                concentration: 1.0e28, // m^-3
                mobility: 0.0032 // m^2/Vs
            }
        };
        
        // User interface elements
        const materialSelect = document.getElementById('material-type');
        const customParams = document.getElementById('custom-parameters');
        const carrierTypeSelect = document.getElementById('carrier-type');
        const concentrationSlider = document.getElementById('carrier-concentration');
        const concentrationValue = document.getElementById('concentration-value');
        const mobilitySlider = document.getElementById('carrier-mobility');
        const mobilityValue = document.getElementById('mobility-value');
        const widthSlider = document.getElementById('sample-width');
        const widthValue = document.getElementById('width-value');
        const thicknessSlider = document.getElementById('sample-thickness');
        const thicknessValue = document.getElementById('thickness-value');
        const currentSlider = document.getElementById('current');
        const currentValue = document.getElementById('current-value');
        const magneticFieldSlider = document.getElementById('magnetic-field');
        const fieldValue = document.getElementById('field-value');
        const runButton = document.getElementById('run-simulation');
        const resetButton = document.getElementById('reset-simulation');
        
        // Result display elements
        const hallVoltageDisplay = document.getElementById('hall-voltage');
        const hallCoefficientDisplay = document.getElementById('hall-coefficient');
        const carrierConcentrationDisplay = document.getElementById('carrier-concentration-result');
        const carrierTypeDisplay = document.getElementById('carrier-type-result');
        
        // Canvas and animation variables
        const canvas = document.getElementById('simulation-canvas');
        const ctx = canvas.getContext('2d');
        let animationFrameId;
        let particles = [];
        let simulationRunning = false;
        
        // Chart variables
        let hallVoltageChart = null;
        let hallCoefficientChart = null;
        const hallVoltageData = [];
        const hallCoefficientData = [];
        
        // Current simulation parameters
        let currentParams = {
            material: MATERIALS.copper,
            width: 10, // mm
            thickness: 1, // mm
            current: 100, // mA
            magneticField: 1.0 // T
        };
        
        // Tab switching
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Deactivate all tabs
                tabs.forEach(t => {
                    t.classList.remove('active');
                });
                
                // Activate the clicked tab
                tab.classList.add('active');
                
                // Show the corresponding content
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // Redraw charts if viewing graphs
                if (tabId === 'graph-view') {
                    updateCharts();
                }
            });
        });
        
        // Initialize UI
        function initUI() {
            // Initial material selection
            materialSelect.addEventListener('change', updateMaterialParams);
            
            // Show/hide custom parameters when needed
            materialSelect.addEventListener('change', () => {
                if (materialSelect.value === 'custom') {
                    customParams.style.display = 'block';
                } else {
                    customParams.style.display = 'none';
                }
                updateMaterialParams();
            });
            
            // Set up sliders and their display values
            updateSlider(concentrationSlider, concentrationValue, (value) => {
                const concentration = Math.pow(10, value);
                MATERIALS.custom.concentration = concentration;
                return `${concentration.toExponential(2).replace('e+', ' × 10^')}`;
            });
            
            updateSlider(mobilitySlider, mobilityValue, (value) => {
                const mobility = Math.pow(10, value);
                MATERIALS.custom.mobility = mobility;
                return mobility.toFixed(4);
            });
            
            updateSlider(widthSlider, widthValue, (value) => {
                currentParams.width = value;
                return `${value.toFixed(1)}`;
            });
            
            updateSlider(thicknessSlider, thicknessValue, (value) => {
                currentParams.thickness = value;
                return `${value.toFixed(1)}`;
            });
            
            updateSlider(currentSlider, currentValue, (value) => {
                currentParams.current = value;
                return `${value}`;
            });
            
            updateSlider(magneticFieldSlider, fieldValue, (value) => {
                currentParams.magneticField = value;
                return `${value.toFixed(1)}`;
            });
            
            // Carrier type selection for custom material
            carrierTypeSelect.addEventListener('change', () => {
                MATERIALS.custom.carrierType = carrierTypeSelect.value;
            });
            
            // Run button
            runButton.addEventListener('click', runSimulation);
            
            // Reset button
            resetButton.addEventListener('click', resetSimulation);
            
            // Initialize charts
            initCharts();
        }
        
        // Update slider value display
        function updateSlider(slider, display, callback) {
            // Initial value update
            display.textContent = callback(parseFloat(slider.value));
            
            // Update on change
            slider.addEventListener('input', () => {
                display.textContent = callback(parseFloat(slider.value));
                
                // Update custom material properties if needed
                if (materialSelect.value === 'custom') {
                    updateMaterialParams();
                }
            });
        }
        
        // Update material parameters from selection
        function updateMaterialParams() {
            const selectedMaterial = materialSelect.value;
            currentParams.material = MATERIALS[selectedMaterial];
            
            // Update carrier type display
            if (currentParams.material.carrierType === 'electrons') {
                carrierTypeDisplay.textContent = 'Electrons (negative)';
            } else {
                carrierTypeDisplay.textContent = 'Holes (positive)';
            }
            
            // Update carrier concentration display
            const concentration = currentParams.material.concentration;
            carrierConcentrationDisplay.textContent = `${concentration.toExponential(2)} m⁻³`;
            
            // Update custom parameter UI
            if (selectedMaterial === 'custom') {
                carrierTypeSelect.value = currentParams.material.carrierType;
                const concentrationValue = Math.log10(currentParams.material.concentration);
                concentrationSlider.value = concentrationValue;
                document.getElementById('concentration-value').textContent = 
                    `${currentParams.material.concentration.toExponential(2).replace('e+', ' × 10^')}`;
                
                const mobilityValue = Math.log10(currentParams.material.mobility);
                mobilitySlider.value = mobilityValue;
                document.getElementById('mobility-value').textContent = 
                    currentParams.material.mobility.toFixed(4);
            }
        }
        
        // Initialize charts
        function initCharts() {
            const voltageCtx = document.getElementById('hall-voltage-chart').getContext('2d');
            hallVoltageChart = new Chart(voltageCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Hall Voltage vs Magnetic Field',
                        backgroundColor: 'rgba(0, 123, 255, 0.2)',
                        borderColor: 'rgba(0, 123, 255, 1)',
                        data: []
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Magnetic Field (T)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Hall Voltage (μV)'
                            }
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            const coefficientCtx = document.getElementById('hall-coefficient-chart').getContext('2d');
            hallCoefficientChart = new Chart(coefficientCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Hall Coefficient vs Current',
                        backgroundColor: 'rgba(40, 167, 69, 0.2)',
                        borderColor: 'rgba(40, 167, 69, 1)',
                        data: []
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Current (mA)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Hall Coefficient (m³/C)'
                            }
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Update charts with new data
        function updateCharts() {
            // Generate data for Hall voltage vs magnetic field
            const bValues = [];
            const vhValues = [];
            const rhValues = [];
            const iValues = [];
            
            // Save current parameters
            const savedField = currentParams.magneticField;
            const savedCurrent = currentParams.current;
            
            // Calculate Hall voltage for different magnetic field values
            for (let b = 0; b <= 2; b += 0.1) {
                currentParams.magneticField = b;
                bValues.push(b.toFixed(1));
                const { hallVoltage } = calculateHallEffect();
                vhValues.push(hallVoltage * 1e6); // Convert to microvolts
            }
            
            // Reset magnetic field
            currentParams.magneticField = savedField;
            
            // Calculate Hall coefficient for different current values
            for (let i = 10; i <= 500; i += 10) {
                currentParams.current = i;
                iValues.push(i);
                const { hallCoefficient } = calculateHallEffect();
                rhValues.push(hallCoefficient);
            }
            
            // Reset current
            currentParams.current = savedCurrent;
            
            // Update Hall voltage chart
            hallVoltageChart.data.labels = bValues;
            hallVoltageChart.data.datasets[0].data = vhValues;
            hallVoltageChart.update();
            
            // Update Hall coefficient chart
            hallCoefficientChart.data.labels = iValues;
            hallCoefficientChart.data.datasets[0].data = rhValues;
            hallCoefficientChart.update();
        }
        
        // Calculate Hall effect parameters
        function calculateHallEffect() {
            const material = currentParams.material;
            const current = currentParams.current * 1e-3; // Convert mA to A
            const magneticField = currentParams.magneticField; // Tesla
            const thickness = currentParams.thickness * 1e-3; // Convert mm to m
            const width = currentParams.width * 1e-3; // Convert mm to m
            
            // Calculate cross-sectional area
            const area = width * thickness; // m^2
            
            // Calculate current density
            const currentDensity = current / area; // A/m^2
            
            // Calculate Hall coefficient (sign depends on carrier type)
            const sign = (material.carrierType === 'electrons') ? -1 : 1;
            const hallCoefficient = sign / (material.concentration * ELEMENTARY_CHARGE);
            
            // Calculate Hall voltage
            const hallVoltage = hallCoefficient * currentDensity * magneticField * width;
            
            // Calculate carrier concentration
            const carrierConcentration = 1 / (Math.abs(hallCoefficient) * ELEMENTARY_CHARGE);
            
            return {
                hallVoltage,
                hallCoefficient,
                carrierConcentration
            };
        }
        
        // Update result displays
        function updateResults() {
            const { hallVoltage, hallCoefficient, carrierConcentration } = calculateHallEffect();
            
            // Display hall voltage in appropriate units
            let voltageDisplayValue, voltageUnit;
            if (Math.abs(hallVoltage) < 1e-6) {
                voltageDisplayValue = (hallVoltage * 1e9).toFixed(2);
                voltageUnit = 'nV';
            } else if (Math.abs(hallVoltage) < 1e-3) {
                voltageDisplayValue = (hallVoltage * 1e6).toFixed(2);
                voltageUnit = 'μV';
            } else {
                voltageDisplayValue = (hallVoltage * 1e3).toFixed(2);
                voltageUnit = 'mV';
            }
            hallVoltageDisplay.textContent = `${voltageDisplayValue} ${voltageUnit}`;
            
            // Display hall coefficient in appropriate format
            hallCoefficientDisplay.textContent = `${hallCoefficient.toExponential(2)} m³/C`;
            
            // Display carrier concentration
            carrierConcentrationDisplay.textContent = `${carrierConcentration.toExponential(2)} m⁻³`;
            
            // Display carrier type
            if (currentParams.material.carrierType === 'electrons') {
                carrierTypeDisplay.textContent = 'Electrons (negative)';
            } else {
                carrierTypeDisplay.textContent = 'Holes (positive)';
            }
        }
        
        // Create particles for simulation
        function createParticles() {
            const numParticles = 50;
            particles = [];
            
            for (let i = 0; i < numParticles; i++) {
                particles.push({
                    x: Math.random() * canvas.width * 0.6 + canvas.width * 0.2,
                    y: Math.random() * canvas.height * 0.6 + canvas.height * 0.2,
                    vx: 1,
                    vy: 0,
                    size: 4,
                    // Deflection will be calculated based on Hall effect
                    deflection: 0
                });
            }
        }
        
        // Draw the simulation
        function drawSimulation() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw sample box
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const boxWidth = canvas.width * 0.7;
            const boxHeight = canvas.height * 0.5;
            
            ctx.fillStyle = '#f0f8ff';
            ctx.fillRect(centerX - boxWidth/2, centerY - boxHeight/2, boxWidth, boxHeight);
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.strokeRect(centerX - boxWidth/2, centerY - boxHeight/2, boxWidth, boxHeight);
            
            // Draw magnetic field symbol (crosses or dots)
            ctx.fillStyle = 'purple';
            const symbolSize = 8;
            const symbolSpacing = 40;
            
            for (let x = centerX - boxWidth/2 + symbolSpacing; x < centerX + boxWidth/2; x += symbolSpacing) {
                for (let y = centerY - boxHeight/2 + symbolSpacing; y < centerY + boxHeight/2; y += symbolSpacing) {
                    if (currentParams.magneticField > 0) {
                        // Draw cross (field going into page)
                        ctx.beginPath();
                        ctx.moveTo(x - symbolSize/2, y - symbolSize/2);
                        ctx.lineTo(x + symbolSize/2, y + symbolSize/2);
                        ctx.moveTo(x + symbolSize/2, y - symbolSize/2);
                        ctx.lineTo(x - symbolSize/2, y + symbolSize/2);
                        ctx.stroke();
                    } else if (currentParams.magneticField < 0) {
                        // Draw dot (field coming out of page)
                        ctx.beginPath();
                        ctx.arc(x, y, symbolSize/2, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                }
            }
            
            // Draw current direction arrows
            const arrowSize = 15;
            ctx.fillStyle = '#333';
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // Left arrow (current in)
            drawArrow(ctx, centerX - boxWidth/2 - 20, centerY, centerX - boxWidth/2, centerY, arrowSize);
            
            // Right arrow (current out)
            drawArrow(ctx, centerX + boxWidth/2, centerY, centerX + boxWidth/2 + 20, centerY, arrowSize);
            
            // Draw Hall voltage direction
            const hallEffect = calculateHallEffect();
            const hallVoltage = hallEffect.hallVoltage;
            
            // Only draw Hall voltage if magnetic field is present
            if (currentParams.magneticField !== 0) {
                ctx.strokeStyle = 'green';
                ctx.lineWidth = 2;
                
                // Draw Hall voltage arrows
                if (hallVoltage > 0) {
                    // Upward arrow for positive Hall voltage
                    drawArrow(ctx, centerX, centerY + boxHeight/2, centerX, centerY + boxHeight/2 + 20, arrowSize);
                    drawArrow(ctx, centerX, centerY - boxHeight/2 - 20, centerX, centerY - boxHeight/2, arrowSize);
                } else if (hallVoltage < 0) {
                    // Downward arrow for negative Hall voltage
                    drawArrow(ctx, centerX, centerY - boxHeight/2, centerX, centerY - boxHeight/2 - 20, arrowSize);
                    drawArrow(ctx, centerX, centerY + boxHeight/2 + 20, centerX, centerY + boxHeight/2, arrowSize);
                }
                
                // Draw voltage measurement points
                ctx.fillStyle = '#444';
                ctx.beginPath();
                ctx.arc(centerX, centerY - boxHeight/2, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(centerX, centerY + boxHeight/2, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                // Draw voltmeter
                ctx.fillStyle = '#eee';
                ctx.strokeStyle = '#444';
                ctx.lineWidth = 1;
                const voltmeterWidth = 50;
                const voltmeterHeight = 30;
                const voltmeterX = centerX + boxWidth/2 + 30;
                const voltmeterY = centerY;
                
                ctx.fillRect(voltmeterX, voltmeterY - voltmeterHeight/2, voltmeterWidth, voltmeterHeight);
                ctx.strokeRect(voltmeterX, voltmeterY - voltmeterHeight/2, voltmeterWidth, voltmeterHeight);
                
                // Draw voltmeter label
                ctx.fillStyle = '#000';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('V', voltmeterX + voltmeterWidth/2, voltmeterY + 3);
                
                // Draw connecting wires
                ctx.strokeStyle = '#555';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY - boxHeight/2);
                ctx.lineTo(centerX, centerY - boxHeight/2 - 10);
                ctx.lineTo(voltmeterX + voltmeterWidth/4, centerY - boxHeight/2 - 10);
                ctx.lineTo(voltmeterX + voltmeterWidth/4, voltmeterY - voltmeterHeight/2);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY + boxHeight/2);
                ctx.lineTo(centerX, centerY + boxHeight/2 + 10);
                ctx.lineTo(voltmeterX + 3*voltmeterWidth/4, centerY + boxHeight/2 + 10);
                ctx.lineTo(voltmeterX + 3*voltmeterWidth/4, voltmeterY + voltmeterHeight/2);
                ctx.stroke();
            }
            
            // Draw carriers (electrons or holes)
            const particleColor = currentParams.material.carrierType === 'electrons' ? 'blue' : 'red';
            ctx.fillStyle = particleColor;
            
            // Calculate the deflection magnitude based on Hall effect
            const deflectionMagnitude = Math.min(0.3, Math.abs(currentParams.magneticField) * 0.3);
            let deflectionDirection = currentParams.magneticField;
            
            // Reverse deflection direction if holes
            if (currentParams.material.carrierType === 'holes') {
                deflectionDirection = -deflectionDirection;
            }
            
            // Draw and update particles
            particles.forEach(particle => {
                // Draw particle
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, 2 * Math.PI);
                ctx.fill();
                
                // Update particle position
                particle.x += particle.vx * 2;
                particle.y += particle.vy + deflectionDirection * deflectionMagnitude;
                
                // Reset particle if it goes out of bounds
                if (particle.x > centerX + boxWidth/2) {
                    particle.x = centerX - boxWidth/2;
                    particle.y = Math.random() * boxHeight + (centerY - boxHeight/2);
                }
            });
            
            // Continue animation
            if (simulationRunning) {
                animationFrameId = requestAnimationFrame(drawSimulation);
            }
        }
        
        // Helper function to draw arrows
        function drawArrow(ctx, fromX, fromY, toX, toY, headSize) {
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);
            
            // Draw line
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            
            // Draw arrowhead
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headSize * Math.cos(angle - Math.PI/6), toY - headSize * Math.sin(angle - Math.PI/6));
            ctx.lineTo(toX - headSize * Math.cos(angle + Math.PI/6), toY - headSize * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fill();
        }
        
        // Run simulation
        function runSimulation() {
            // Cancel any existing animation
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            
            // Update results
            updateResults();
            
            // Create particles
            createParticles();
            
            // Start animation
            simulationRunning = true;
            animationFrameId = requestAnimationFrame(drawSimulation);
            
            // Update charts
            updateCharts();
        }
        
        // Reset simulation parameters to defaults
        function resetSimulation() {
            // Reset material selection
            materialSelect.value = 'copper';
            customParams.style.display = 'none';
            
            // Reset sliders
            widthSlider.value = '10';
            widthValue.textContent = '10.0';
            currentParams.width = 10;
            
            thicknessSlider.value = '1';
            thicknessValue.textContent = '1.0';
            currentParams.thickness = 1;
            
            currentSlider.value = '100';
            currentValue.textContent = '100';
            currentParams.current = 100;
            
            magneticFieldSlider.value = '1';
            fieldValue.textContent = '1.0';
            currentParams.magneticField = 1.0;
            
            // Reset custom material parameters
            concentrationSlider.value = '28';
            concentrationValue.textContent = '1.00 × 10^28';
            MATERIALS.custom.concentration = 1.0e28;
            
            mobilitySlider.value = '-2.5';
            mobilityValue.textContent = '0.0032';
            MATERIALS.custom.mobility = 0.0032;
            
            carrierTypeSelect.value = 'electrons';
            MATERIALS.custom.carrierType = 'electrons';
            
            // Update material params
            currentParams.material = MATERIALS.copper;
            
            // Run simulation with new params
            runSimulation();
        }
        
        // Initialize the application
        window.onload = function() {
            initUI();
            resetSimulation();
        };
    </script>
</body>
</html>